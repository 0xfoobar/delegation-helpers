# Liquid Delegate

Liquid Delegate is a protocol to to tokenize the delegation rights of your spot ERC721s, ERC20s, and ERC1155s.
Users deposit a spot asset and receive two tokens in return: the Delegate Token and the Principal Token. 
The Delegate Token represents the delegation (utility) rights for the chosen duration and the Principal Token represents the rights to claim the underlying escrowed asset at expiration.

## Contracts
Describes the upper-level contracts.

- [DelegateToken](./src/DelegateToken.sol): Manages the core delegate rights, stores the
  underlying NFTs and keeps track expiries.
- [PrincipalToken](./src/PrincipalToken.sol): Keeps track of the principal rights
- [WrapOfferer](./src/WrapOfferer.sol): Seaport contract offerer to allow for direct creation and
  sale of delegate tokens as part of an order

## Technical Details

### Principal-Delegate Token Duality

Unlike V1, Liquid Delegate V2 is a dual token system. Not only does V2 tokenize the delegation
rights as transferrable, tradeable ERC721 tokens but also tokenizes the right to withdraw the
underlying token once the rights expire. In V1 this right would remain fixed and assigned to the
original `depositor` until the claim expired. Tokenization of the "right to principal" allows for
the underlying token to still be traded, transferred and sold while the underlying token is locked
in the `DelegateToken` contract. The delegate rights tokens or just "delegate tokens" for short
are tracked in the `DelegateToken` contract and the principal rights tokens are tracked in the
`PrincipalToken` contract, together they'll be referred to as "rights tokens".

![Rights Lifecycle](assets/rights-lifecycle.svg)

Diagram: The state and transitions of a pair of rights.

> **WARNING:** The delegate token will be **force burned** when the principal holder redeems their
token after the rights expire. Make sure you only deposit your delegate token into secondary
contracts for the duration of the expiry to avoid certain protocol / lending positions that might
expect all deposited tokens to be transferrable.

### Seaport-based Rights Creation via [WrapOfferer](./src/WrapOfferer.sol)
The `WrapOfferer` contract is a Seaport "contract offerer" that facilitates the creation of V2
delegation rights directly via Seaport orders. This is done via the `CONTRACT` order type which
allows contracts to dynamically create orders on the fly based on arbitrary data via a standardized
interface.

Like any participant in a Seaport order contract offerers also have offers (items they give up) and
considerations (items they expect to receive / others to receive) for their orders to validated. The
core order generated by the `WrapOfferer` is very simple:

**Offer items (n >= 1):**
- _Wrap Receipt_ (can issue as many identical receipts as desired)

**Consideration items (1):**
- Expect the `DelegateToken` contract to receive the underlying token to be wrapped i.e. locked.

#### Wrap Receipt
The wrap receipt is a commitment to specific delegation parameters (rights recipients, token, collection, expiry, etc.)
and ensures that the principal & delegate tokens go to the right parties.

#### Contract Offer Context
As part of contract orders Seaport requires providing context data in the `extraData` field. For the
`WrapOfferer` contract the context contains the necessary data to reconstruct and validate the
receipt. The extra data can be constructed or interpreted by calling the `WrapOfferer`'s
`encodeContext(...)` and `decodeContext(bytes)` methods.

See the [`./test/WrapOfferer.t.sol`](./test/WrapOfferer.t.sol) file for examples on how to use the
contract offerer.


